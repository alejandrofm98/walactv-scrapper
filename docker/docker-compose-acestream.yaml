services:
  acestream:
    build:
      context: ..
      dockerfile: docker/Dockerfile-acestream-${ARCH:-x64}
    container_name: acestream
    restart: unless-stopped
    hostname: acestream
    dns:
      - 8.8.8.8
      - 1.1.1.1
    tmpfs:
      - /dev/shm:size=4g
      - /root/.ACEStream:size=2g
      - /tmp:size=1g
    environment:
      TZ: Europe/Madrid
      ALLOW_REMOTE_ACCESS: "yes"
      CACHE_SIZE: "1024"
      DISK_CACHE_SIZE: "1536"
      ACESTREAM_EMAIL: ${ACESTREAM_EMAIL}
      ACESTREAM_PASSWORD: ${ACESTREAM_PASSWORD}
    volumes:
      - acestream-config:/acestream.engine
    networks:
      - dokploy-network
    deploy:
      resources:
        limits:
          memory: 4G
        reservations:
          memory: 2G
    labels:
      - "traefik.enable=true"
      - "traefik.docker.network=dokploy-network"
      # HTTPS Router
      - "traefik.http.routers.acestream-https.rule=Host(`acestream.walerike.com`)"
      - "traefik.http.routers.acestream-https.entrypoints=websecure"
      - "traefik.http.routers.acestream-https.tls=true"
      - "traefik.http.routers.acestream-https.tls.certresolver=letsencrypt"
      - "traefik.http.routers.acestream-https.service=acestream-proxy-svc"
      # HTTP Router
      - "traefik.http.routers.acestream-http.rule=Host(`acestream.walerike.com`)"
      - "traefik.http.routers.acestream-http.entrypoints=web"
      - "traefik.http.routers.acestream-http.service=acestream-proxy-svc"
      # Service apunta al puerto del proxy (3000) - usa el puerto interno del contenedor
      - "traefik.http.services.acestream-proxy-svc.loadbalancer.server.port=3000"

volumes:
  acestream-config:

networks:
  dokploy-network:
    external: true